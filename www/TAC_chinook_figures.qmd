---
title: "Track-a-Cohort: Winter-run Chinook"
date: "Last updated: `r Sys.Date()`"
format: html
output:
  html_document: 
   toc: true
   toc_float: true
   code_folding: true
   cache: true 
editor: visual
bibliography: ../www/refs/references.bib
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE)
```

## Objective

Using shared resources via [BDO github](https://github.com/BDO-Science/track-a-cohort) from BOR, replicate figures and adjust to include dynamic data. See [Track a cohort_WR_plots.docx](https://github.com/BDO-Science/track-a-cohort/blob/main/Track%20a%20Cohort_WR_plots.docx) for figures requested. Also consider future additions including more interactive capabilities to certain graphs in form of Rmarkdown and/or shinyapp. Figures below are in development and require updates as data becomes available.

```{r, include=FALSE}
library(here)
source(here("R/load_dependencies.R"))

#set current year
source(here("R/utils_fct_assign_current_water_year.R"))
current_year <- assign_current_water_year()
```

## Figure 1. Juvenile Production Estimate

```{r, load_plot_01, fig.width=10, fig.height=6}
source(here("R/winter_run_chinook_plot_annual_jpe.R"))
```

Related links: [SacPas Page](https://www.cbr.washington.edu/sacramento/data/jpe_data.html), [GitHub Repo Code](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_annual_jpe.R)

-   Issues:
    -   Update genetic data as it becomes available
    -   Update method naming conventions as needed

## Figure 2. Survival and Routing Probabilites

### Option 1: Facetted by year

```{r, load_plot_02, fig.width=12, fig.height=18 }
source(here("R/winter_run_chinook_plot_STARS.R"))
```

### Option 2: Without faceted years

```{r,  load_plot_02_alt, fig.width=12, fig.height=18}
source(here("R/winter_run_chinook_plot_STARS_withoutfacetedyears.R"))
```

Related links: SacPas Page, [Interactive Plot](https://csobrien.shinyapps.io/TAC_WRChinook_STARS/), [GitHub Repo Code](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_STARS.R), [STARS ShinyApp](https://www.cbr.washington.edu/shiny/STARS/)

## Figure 3. Juvenile Production Estimate (JPE) – Percent Loss

### Figure 3a. Genetic vs Length-At-Date (LAD) Historical Percent Loss of JPE

```{r load_plot_03a, fig.width=10, fig.height=6}
source(here("R/winter_run_chinook_plot_pct_genetic_lad_loss_jpe.R"))
```

Related links: SacPas Page, [GitHub Repo Code](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_pct_genetic_lad_loss_jpe.R)

### Figure 3b. Cumulative Genetic Percent Loss of JPE

```{r, load_plot_03b, fig.width=10, fig.height=6}
source(here("R/winter_run_chinook_plot_pct_cumulative_genetic_loss_jpe.R"))
```

Related links: SacPas Page, ShinyApp, [GitHub Repo Code](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_pct_cumulative_genetic_loss_jpe.R)

-   Issues:
    -   Confirm use of Water Year over Brood Year - both were used in word doc shared
    -   Confirm missing 2008 JPE data
    -   Update genetic data as it becomes available
    -   Update method naming conventions as needed
    -   Confirm loss URL sourced from SacPas
    -   add ShinyApp for interactive capabilities for 3b (i.e., hydrological classifications, plotly filtering of data, etc.)

## Figure 4. Juvenile Production Estimate (JPE) – Number Loss

### Figure 4a. Genetic vs Length-At-Date (LAD) Historical Loss of the JPE

```{r, load_plot4a, fig.width=10, fig.height=6}
source(here("R/winter_run_chinook_plot_count_genetic_lad_loss_jpe.R"))
```

Related links: SacPas Page, [GitHub Repo Code](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_count_genetic_lad_loss_jpe.R)

### Figure 4b. Cumulative Length-At-Date (LAD) loss of the JPE

```{r, load_plot4b, fig.width=10, fig.height=10}
source(here("R/winter_run_chinook_plot_count_cumulative_lad_loss_jpe.R"))
```

Related links: SacPas Page, ShinyApp, [GitHub Repo Code](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_count_cumulative_lad_loss_jpe.R)

-   Issues:
    -   Update genetic data as it becomes available
    -   Update method naming conventions as needed
    -   Confirm loss URL sourced from SacPas
    -   add ShinyApp for interactive capabilities for 3b (i.e., hydrological classifications, plotly filtering of data, etc.)

## Figure 5. Single Year Thresholds

### Figure 5a. Cumulative Genetic Loss for Current Water Year

```{r, load_plot5a, fig.width=10, fig.height=6}
source(here("R/winter_run_chinook_plot_count_cumulative_genetic_loss_single_year_thresholds.R"))
```

### Figure 5b. Cumulative LAD Loss for Current Water Year

```{r, load_plot5b, fig.width=10, fig.height=6}
source(here("R/winter_run_chinook_plot_count_cumulative_lad_loss_single_year_thresholds.R"))
```

Related links: [SacPas Page](https://www.cbr.washington.edu/sacramento/workgroups/salmon_monitoring.html#loss), ShinyApp, [GitHub Repo Code: cumul_genetic_loss](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_count_cumulative_genetic_loss_single_year_thresholds.R) , [GitHub Repo Code: cumul_lad_loss](https://github.com/caitobrien/TAC/blob/main/R/winter_run_chinook_plot_count_cumulative_lad_loss_single_year_thresholds.R) ,

-   Issues:
    -   Confirm loss URL sourced from SacPas
    -   Confirm single year threshold and naming conventions

## Figure 6. Tillotson predicted loss with OMR scenarios

-pending

Issues:

-   Confirm Tillotson predicted loss with OMR scenarios -- pull from SacPas or other use Tillotson.R code?

## Figure 7. Hatchery Percent Loss

```{r, load_plot7, fig.width=10, fig.height=12}
 source(here("R/winter_run_chinook_hatchery_plot_pct_loss.R"))
```

-   Issues:
    -   Confirm this plot is even wanted or an accidental addition to the `Track a cohort_WR_plots docx` shared. Named Fig 5 in .docx

    -   Confirm data import URL sourced from SacPas when it becomes available

    -   Update figure with additional years as data becomes available
