---
title: "Track-a-Cohort: Steelhead"
date: "Last updated: `r Sys.Date()`"
format: html
output:
  html_document: 
   toc: true
   toc_float: true
   code_folding: true
   cache: true 
editor: visual
bibliography: ../www/refs/references.bib
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE)
```

## Background

Objective: Using shared resources via [BDO github](https://github.com/BDO-Science/track-a-cohort) from BOR, replicate figures and adjust to include dynamic data. See [Track a cohort_Steelhead.docx](https://github.com/BDO-Science/track-a-cohort/blob/main/SH_Cohort/Track%20a%20Cohort_Steelhead.docx) for figures requested. Also consider future additions including more interactive capabilities to certain graphs in form of Rmarkdown and/or shinyapp

```{r, include=FALSE}
library(here)
source(here("R/load_dependencies.R"))

#set current year
source(here("R/utils_fct_assign_current_water_year.R"))
current_year <- assign_current_water_year()
```

## Figure 1. RBDD Juvenile Passage Estimates 

```{r, load_plot_01, fig.width=10, fig.height=6}
source(here("R/steelhead_plot_rbdd_biweekly_passage.R"))
```

- Issues:
  - Update biweekly shaded areas based on SI generated methods
  
## Figure 2. Survival and Routing Probabilites

Note: Using Winter-run Chinook as a surrogate for Steelhead

### Facetted by year

```{r, load_plot_02, fig.width=12, fig.height=12 }
source(here("R/winter_run_chinook_plot_STARS.R"))
```

### Without faceted years

```{r,  load_plot_02_alt, fig.width=12, fig.height=12}
source(here("R/winter_run_chinook_plot_STARS_withoutfacetedyears.R"))
```

## Figure 3. Comparison of Clipped and Unclipped Loss

### Figure 3a. Total Loss of Clipped and Unclipped Steelhead

```{r load_plot_03a, fig.width=10, fig.height=6}
source(here("R/steelhead_plot_count_total_loss.R"))
```

### Figure 3b. Size Distribution of Loss

```{r load_plot_03b, fig.width=10, fig.height=6, fig.cap="Figure includes density plots that highlight historical (WY1994 to WY2023) size distribution and histogram of current year (WY2024) size distribution by rear type. Fork lengths below 750 mm were included in dataset."}
source(here("R/steelhead_plot_size_distribution_loss.R"))
```

### Figure 3c. Size Distribution of Steelhead Loss By Year

```{r load_plot_03c, fig.width=6, fig.height=10}
source(here("R/steelhead_plot_size_distribution_by_year_loss.R"))
```

## Figure 4. Cumulative Loss

```{r load_plot_04, fig.width=10, fig.height=10}
source(here("R/steelhead_plot_count_cumulative_loss.R"))
```

## Table 1. Minimization of Cumulative Loss of Hatchery Steelhead

*Pending steelhead hatchery release information


```{r, load_table_01}
# Load the data
load(here("data/steelhead_loss_data.rda"))

#load function to wrangle into table format
source(here("R/steelhead_fct_generate_table_total_hatchery_loss.R"))

# generate HTML table
generate_table_steelhead_total_hatchery_loss(steelhead_loss_data)

```

- Issues:
  - Update with steelhead hatchery release information when becomes available
  
  
## Figure 5. Daily Loss, Exports, and Pumping Rates by Facility

```{r load_plot_05, fig.width=10, fig.height=6}
source(here("R/steelhead_plot_daily_loss_export.R"))
```


Issues:
- Update with SacPas generated link for Export data per Facility, closest data found: [https://www.cbr.washington.edu/sacramento/tmp/juvloss_1719955580_301.html](https://www.cbr.washington.edu/sacramento/tmp/juvloss_1719955580_301.html)

- 
  